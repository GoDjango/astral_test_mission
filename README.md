# astral_test_mission

### Внимание

Весь код требует рефакторинга, т.к. писалось все на скорую руку.
В ходе выполнения тестового возникли некоторые вопросы, и непонятные для меня моменты.

#### Загрузка нового документа [POST] /api/docs
```json
{
    "meta": {
      "name": "photo.jpg",
      "file": true,
      "public": false,
      "token": "sfuqwejqjoiu93e29",
      "mime": "image/jpg",
      "grant": [
        "login1",
        "login2"
      ]
    }
}
```

1. Что такое поле file? По идее каждый документ это файл, т.е. это поле всегда true.
2. Что такое поле public? Это доступность файла для всех пользователей?
3. Поле token. Для чего поле token передавать здесь в объекте meta, а не вынести его из объекта? 
   Если передавать значение поля token в Headers к примеру, то можно было все запросы
   к **/api/docs** реализовать через middleware, в котором и проверять валидность токена.

#### Получение списка документов [GET, HEAD] /api/docs

Вопросы к входящим параметрам:

Вход
1. token
2. login - опционально — если не указан — то список своих
3. key - имя колонки для фильтрации
4. value - значение фильтра
5. limit - кол-во документов в списке


1. Поле token, передается через json или через параметр адресной строки?
   Здесь и в остальных GET,HEAD,DELETE запросах я реализовал через адресную строку.
2. Поле login. Это фильтрация документов по пользователю?
3. Фильтры реализовать не успел.
4. limit - сделано, но нужен ли offset? Его не добавлял, так как в описании об этом ни слова.

#### Получение одного документа [GET, HEAD] /api/docs/<id>

Выход

1. Что значит "Если JSON"?

### Что не сделано
1. Получение документов, в зависимости от доступа пользователей к документам
2. Фильтрация документов при получении списка по key=value
3. Плохо протестировано

### Инфраструктура

1. Postgres - для хранения информации о документах, доступах, пользователях, токенах
2. Minio - для хранения файлов
3. В качестве кеша исользовалась оперативная память. (Можно было сделать на Redis)

### Схема БД

users:

| Название поля | Тип поля |Описание|
|---------------|----------|---------|
| id            | integer  ||
| login         | varchar  ||
| password      | varchar  |Захэшированый пароль|

docs:

| Название поля | Тип поля  | Описание             |
|---------------|-----------|----------------------|
| id            | integer   ||
| filename      | varchar   ||
| public        | boolean   ||
| mime          | varchar   ||
| owner_id      | integer   | Foreign key на users |
| created      | timestamp | Дата создания        |

users_docs_grant:

| Название поля | Тип поля | Описание            |
|---------------|----------|---------------------|
| doc_id        | integer  | Foreign key на docs |
| user_id       | integer  |Foreign key на users|

tokens:

| Название поля | Тип поля | Описание             |
|---------------|----------|----------------------|
| token         | varchar  | Сгенерированый токен |
| user_id       | integer  | Foreign key на users |


### Запуск

```shell
docker-compose up -d --build
```
